webpackJsonp([11],{"9tg/":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r("rdYn"),a=r("jog2"),n=!1;var s=function(e){n||r("b9L+")},c=r("VU/8")(i.a,a.a,!1,s,null,null);c.options.__file="pages/lxd/certificates.vue",t.default=c.exports},CEiN:function(e,t,r){(e.exports=r("FZ+f")(!1)).push([e.i,"",""])},"b9L+":function(e,t,r){var i=r("CEiN");"string"==typeof i&&(i=[[e.i,i,""]]),i.locals&&(e.exports=i.locals);r("rjj0")("a5c14210",i,!1,{sourceMap:!1})},jog2:function(e,t,r){"use strict";var i=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("v-app",[r("v-snackbar",{attrs:{top:"",timeout:e.snackbarTimeout,color:e.snackbarColor},model:{value:e.snackbar,callback:function(t){e.snackbar=t},expression:"snackbar"}},[e._v("\n    "+e._s(e.snackbarText)+"\n    "),r("v-btn",{attrs:{dark:"",flat:""},nativeOn:{click:function(t){e.snackbar=!1}}},[e._v("Close")])],1),r("v-content",[r("v-container",{attrs:{fluid:"",tag:"section",id:"grid"}},[r("v-layout",{attrs:{row:"",wrap:""}},[r("v-flex",{attrs:{"d-flex":"",xs12:"","order-xs5":""}},[r("v-layout",{attrs:{column:""}},[r("v-flex",{staticClass:"display mb-2",attrs:{tag:"h1"}},[r("v-layout",{attrs:{row:"",wrap:""}},[r("v-flex",{attrs:{xs12:"",sm6:""}},[e._v("\n                  LXD - Certificates\n                ")]),r("v-flex",{attrs:{xs12:"",sm6:""}},[r("v-btn",{staticStyle:{float:"right"},attrs:{small:"",color:"success"},on:{click:function(t){e.dialog.editing=!0}}},[e._v("Add Certificate")]),r("v-btn",{staticStyle:{float:"right"},attrs:{small:""},on:{click:function(t){e.dialog.generate=!0}}},[e._v("Generate Certificate")])],1)],1)],1),r("v-flex",[r("v-alert",{attrs:{type:"error",value:e.error.global}},[e._v("\n                "+e._s(e.error.global)+"\n              ")]),r("v-data-table",{staticClass:"elevation-1",attrs:{headers:e.tableHeaders,items:e.items,"hide-actions":"",loading:e.tableLoading},scopedSlots:e._u([{key:"items",fn:function(t){return[r("tr",[r("td",[r("a",{attrs:{href:"javascript:void(0)"},on:{click:function(r){r.stopPropagation(),e.editItem(t.item)}}},[e._v(e._s(t.item.name?t.item.name:"-"))])]),r("td",[e._v(e._s(t.item.type?e.ucfirst(t.item.type):"-"))]),r("td",[e._v(e._s(t.item.fingerprint?t.item.fingerprint:"-"))]),r("td",[r("v-btn",{staticClass:"mx-0",staticStyle:{float:"right"},attrs:{icon:""},on:{click:function(r){r.stopPropagation(),e.deleteItem(t.item)}}},[r("v-icon",{attrs:{color:"pink"}},[e._v("delete")])],1)],1)])]}}])},[r("v-progress-linear",{attrs:{slot:"progress",color:"blue",indeterminate:""},slot:"progress"}),r("template",{slot:"no-data"},[e._v("\n                  "+e._s(e.tableLoading?"Fetching data, please wait...":"There are currently no certificates.")+"\n                ")])],2)],1)],1)],1)],1)],1),r("v-dialog",{attrs:{"max-width":"510px",scrollable:""},model:{value:e.dialog.editing,callback:function(t){e.$set(e.dialog,"editing",t)},expression:"dialog.editing"}},[r("v-card",{attrs:{tile:""}},[r("v-toolbar",{attrs:{card:"",dark:"",color:"light-blue darken-3"}},[r("v-btn",{attrs:{icon:"",dark:""},nativeOn:{click:function(t){e.dialog.editing=!1}}},[r("v-icon",[e._v("close")])],1),r("v-toolbar-title",[e._v(e._s(-1===e.editingIndex?"Add":"Edit")+" Certificate")]),r("v-spacer"),r("v-toolbar-items",[r("v-btn",{attrs:{dark:"",flat:""},nativeOn:{click:function(t){e.save()}}},[e._v("Save")])],1)],1),r("v-card-text",{staticStyle:{padding:"0px"}},[r("v-card",{attrs:{flat:""}},[r("v-card-text",[r("v-alert",{attrs:{type:"error",value:e.error.editing}},[e._v("\n                "+e._s(e.error.editing)+"\n              ")]),r("v-form",{ref:"form_editing",attrs:{"lazy-validation":""},model:{value:e.valid.editing,callback:function(t){e.$set(e.valid,"editing",t)},expression:"valid.editing"}},[r("v-text-field",{attrs:{label:"Common Name:",rules:e.nameRule,placeholder:"",required:"",hint:"Common Name (CN) for the certificate."},model:{value:e.editingItem.name,callback:function(t){e.$set(e.editingItem,"name",t)},expression:"editingItem.name"}}),r("v-select",{attrs:{items:["client"],label:"Type:",hint:"Certificate type (keyring), currently only client"},model:{value:e.editingItem.type,callback:function(t){e.$set(e.editingItem,"type",t)},expression:"editingItem.type"}}),-1===e.editingIndex?r("div",[r("v-text-field",{attrs:{rules:e.certificateRule,label:"PEM Certificate:",placeholder:"",hint:"If provided, a valid x509 certificate. If not, the client certificate of the connection will be used.","multi-line":""},model:{value:e.editingItem.certificate,callback:function(t){e.$set(e.editingItem,"certificate",t)},expression:"editingItem.certificate"}})],1):r("div",[r("h3",[e._v("Client Certificate")]),r("pre",{staticStyle:{"font-size":"12px"}},[e._v(e._s(e.editingItem.certificate))])])],1)],1)],1)],1),r("div",{staticStyle:{flex:"1 1 auto"}})],1)],1),r("v-dialog",{attrs:{"max-width":"510px",scrollable:""},model:{value:e.dialog.generate,callback:function(t){e.$set(e.dialog,"generate",t)},expression:"dialog.generate"}},[r("v-card",{attrs:{tile:""}},[r("v-toolbar",{attrs:{card:"",dark:"",color:"light-blue darken-3"}},[r("v-btn",{attrs:{icon:"",dark:""},nativeOn:{click:function(t){e.dialog.generate=!1}}},[r("v-icon",[e._v("close")])],1),r("v-toolbar-title",[e._v("Generate Certificate")]),r("v-spacer"),r("v-toolbar-items",[r("v-btn",{attrs:{dark:"",flat:"",loading:e.generating,disabled:e.generating},nativeOn:{click:function(t){e.generateCert()}}},[e._v("Generate")])],1)],1),r("v-card-text",{staticStyle:{padding:"0px"}},[r("v-card",{attrs:{flat:""}},[r("v-card-text",[r("v-alert",{attrs:{type:"error",value:e.error.generate}},[e._v("\n                "+e._s(e.error.generate)+"\n              ")]),r("v-form",{ref:"form_generate",attrs:{"lazy-validation":""},model:{value:e.valid.generate,callback:function(t){e.$set(e.valid,"generate",t)},expression:"valid.generate"}},[""!==e.cert.key?r("div",[r("h2",[e._v("Client Certificate "),r("v-btn",{staticStyle:{float:"right"},attrs:{dark:"",small:"",color:"success"},on:{click:function(t){e.addCert()}}},[e._v("Add To LXD")]),r("v-btn",{staticStyle:{float:"right"},attrs:{dark:"",small:"",color:"blue"},on:{click:function(t){e.downloadCert("pem")}}},[e._v("Download")])],1),r("pre",{staticStyle:{"font-size":"12px"}},[e._v(e._s(e.cert.pem))]),r("h2",{staticStyle:{"margin-top":"15px"}},[e._v("Private Key "),r("v-btn",{staticStyle:{float:"right"},attrs:{dark:"",small:"",color:"blue"},on:{click:function(t){e.downloadCert("key")}}},[e._v("Download")])],1),r("pre",{staticStyle:{"font-size":"12px"}},[e._v(e._s(e.cert.key))])]):r("div",[r("h3",[e._v("General")]),r("v-select",{attrs:{disabled:e.generating,items:["2048","4096","8192"],label:"Key Length:",hint:"RSA key length. 8192 takes considerably longer to generate."},model:{value:e.cert.bits,callback:function(t){e.$set(e.cert,"bits",t)},expression:"cert.bits"}}),r("v-text-field",{attrs:{disabled:e.generating,label:"Days:",rules:e.daysRule,placeholder:"",required:"",hint:"Length in days the certificate is valid for."},model:{value:e.cert.days,callback:function(t){e.$set(e.cert,"days",t)},expression:"cert.days"}}),r("h3",[e._v("CSR Subject")]),r("v-text-field",{attrs:{disabled:e.generating,label:"Common Name:",rules:e.commonNameRule,placeholder:"",required:"",hint:"Common Name (CN) for the certificate."},model:{value:e.cert.subject.cn,callback:function(t){e.$set(e.cert.subject,"cn",t)},expression:"cert.subject.cn"}}),r("v-text-field",{attrs:{disabled:e.generating,label:"Country:",rules:e.countryRule,placeholder:"",required:"",hint:"Two-letter country code. e.g. GB"},model:{value:e.cert.subject.c,callback:function(t){e.$set(e.cert.subject,"c",t)},expression:"cert.subject.c"}}),r("v-text-field",{attrs:{disabled:e.generating,label:"State:",rules:e.stateRule,placeholder:"",required:"",hint:"State, county or region. e.g: London"},model:{value:e.cert.subject.st,callback:function(t){e.$set(e.cert.subject,"st",t)},expression:"cert.subject.st"}}),r("v-text-field",{attrs:{disabled:e.generating,label:"Locality:",rules:e.localityRule,placeholder:"",required:"",hint:"City or town. e.g: Wimbledon"},model:{value:e.cert.subject.l,callback:function(t){e.$set(e.cert.subject,"l",t)},expression:"cert.subject.l"}}),r("v-text-field",{attrs:{disabled:e.generating,label:"Organization:",rules:e.organizationRule,placeholder:"",required:"",hint:"Registered name of the organization. e.g: Conext"},model:{value:e.cert.subject.o,callback:function(t){e.$set(e.cert.subject,"o",t)},expression:"cert.subject.o"}}),r("v-text-field",{attrs:{disabled:e.generating,label:"Organization Unit:",rules:e.organizationUnitRule,placeholder:"",required:"",hint:"Name of the department. e.g: IT Department"},model:{value:e.cert.subject.ou,callback:function(t){e.$set(e.cert.subject,"ou",t)},expression:"cert.subject.ou"}})],1)])],1)],1)],1),r("div",{staticStyle:{flex:"1 1 auto"}})],1)],1)],1)],1)};i._withStripped=!0;var a={render:i,staticRenderFns:[]};t.a=a},rO6o:function(e,t,r){"use strict";t.a={methods:{formatBytes:function(e,t){if(0===e)return"0 Bytes";var r=t||2,i=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,i)).toFixed(r))+" "+["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"][i]},isIP4:function(e){return!!/^([0-9]{1,3}\.){3}[0-9]{1,3}(\/([0-9]|[1-2][0-9]|3[0-2]))?$/.test(e)},uniqueId:function(e){e||(e=8);for(var t="",r=1;r<e+1;r+=8)t+=Math.random().toString(36).substr(2,10);return t.substr(0,e)},UUID:function(){function e(){return Math.random().toString(16).slice(-4)}return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()}}}},rdYn:function(e,t,r){"use strict";var i=r("Xxa5"),a=r.n(i),n=r("woOf"),s=r.n(n),c=r("exGp"),o=r.n(c),l=r("Dd8w"),d=r.n(l),u=r("NYxO"),g=(r("4swq"),r("mtWM")),f=r.n(g),v=r("rO6o");t.a={mixins:[v.a],middleware:["authenticated"],components:{},computed:d()({},Object(u.mapGetters)({isAuthenticated:"auth/isAuthenticated",loggedUser:"auth/loggedUser",loggedToken:"auth/loggedToken"})),data:function(){return{dialog:{editing:!1,generate:!1},valid:{editing:!0,generate:!0},generating:!1,error:{global:!1,editing:!1,generate:!1},snackbar:!1,snackbarColor:"green",snackbarText:"",snackbarTimeout:5e3,items:[],cert:{bits:"2048",days:365,subject:{c:"",st:"",l:"",o:"",ou:"",cn:""},key:"",pem:""},tableLoading:!0,tableHeaders:[{text:"Name",value:"name"},{text:"Type",value:"type"},{text:"Fingerprint",value:"fingerprint"},{text:"Actions",value:"action",sortable:!1,align:"right"}],editingIndex:-1,editingItem:{name:"",type:"client",fingerprint:"",certificate:""},defaultItem:{name:"",type:"client",fingerprint:"",certificate:""},nameRule:[function(e){return!!e||"Name is required"}],certificateRule:[function(e){return!!e||"Certificate is required"}],daysRule:[function(e){return!!e||"Days is required"},function(e){return e&&!isNaN(e)||"Days is numeric"}],commonNameRule:[function(e){return!!e||"Common name is required"}],countryRule:[function(e){return!!e||"Country is required"},function(e){return e&&2==e.length||"Country is a 2 letter code"}],stateRule:[function(e){return!!e||"State is required"}],localityRule:[function(e){return!!e||"Locality is required"}],organizationRule:[function(e){return!!e||"Organization is required"}],organizationUnitRule:[function(e){return!!e||"Organization Unit is required"}]}},beforeDestroy:function(){},mounted:function(){var e=o()(a.a.mark(function e(){var t,r=this;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(f.a.defaults.headers.common.Authorization="Bearer "+this.loggedToken,this.$storage.isset("lxd")){e.next=15;break}return e.prev=2,e.next=5,f.a.get(this.loggedUser.sub+"/api/lxd");case 5:t=e.sent,this.$storage.set("lxd",t.data),this.lxd=t.data,e.next=13;break;case 10:e.prev=10,e.t0=e.catch(2),this.$storage.remove("lxd");case 13:e.next=16;break;case 15:this.lxd=this.$storage.get("lxd");case 16:this.$nextTick(function(){r.initialize(),r.cert=s()(r.cert,r.$storage.get("cert_default")),console.log(r.cert)});case 17:case"end":return e.stop()}},e,this,[[2,10]])}));return function(){return e.apply(this,arguments)}}(),watch:{"dialog.editing":function(e){e||this.close()},"dialog.generate":function(e){e||this.close()}},methods:{initialize:function(){var e=o()(a.a.mark(function e(){var t;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,this.loggedUser||this.$router.replace("/servers"),e.next=4,f.a.get(this.loggedUser.sub+"/api/lxd/certificates");case 4:t=e.sent,this.items=t.data.data,e.next=13;break;case 8:e.prev=8,e.t0=e.catch(0),this.items=[],this.tableNoData="No data.",this.error.global="Could not fetch data from server.";case 13:this.tableLoading=!1;case 14:case"end":return e.stop()}},e,this,[[0,8]])}));return function(){return e.apply(this,arguments)}}(),generateCert:function(){var e=o()(a.a.mark(function e(){var t;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.$refs.form_generate.validate()){e.next=14;break}return this.generating=!0,e.prev=2,this.loggedUser||this.$router.replace("/servers"),this.$storage.set("cert_default",{bits:String(this.cert.bits),days:String(this.cert.days),subject:{c:this.cert.subject.c,st:this.cert.subject.st,l:this.cert.subject.l,o:this.cert.subject.o,ou:this.cert.subject.ou,cn:this.cert.subject.cn}}),e.next=7,f.a.post(this.loggedUser.sub+"/api/lxd/certificates/generate",this.cert);case 7:t=e.sent,this.cert=t.data.data,this.generating=!1,e.next=14;break;case 12:e.prev=12,e.t0=e.catch(2);case 14:case"end":return e.stop()}},e,this,[[2,12]])}));return function(){return e.apply(this,arguments)}}(),downloadCert:function(e){var t=document.createElement("a");t.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(this.cert[e])),t.setAttribute("download","cert."+("pem"==e?"pem":"key")),t.style.display="none",document.body.appendChild(t),t.click(),document.body.removeChild(t)},addCert:function(){var e=o()(a.a.mark(function e(){var t;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.$refs.form_generate.validate()){e.next=13;break}return e.prev=1,this.loggedUser||this.$router.replace("/servers"),e.next=5,f.a.post(this.loggedUser.sub+"/api/lxd/certificates",{name:this.cert.subject.cn,type:"client",certificate:this.cert.pem});case 5:200==(t=e.sent).data.code&&(this.snackbar=!0,this.snackbarText="Certificate successfully added.",this.initialize()),t.data.error&&(this.error.generate=t.data.error),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(1),this.error.global="Could not save certificates to server.";case 13:case"end":return e.stop()}},e,this,[[1,10]])}));return function(){return e.apply(this,arguments)}}(),editItem:function(e){this.editingIndex=this.items.indexOf(e),this.editingItem=s()({},this.defaultItem,e),this.dialog.editing=!0},save:function(){var e=o()(a.a.mark(function e(){var t;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.$refs.form_editing.validate()){e.next=20;break}if(e.prev=1,this.loggedUser||this.$router.replace("/servers"),!(this.editingIndex>-1)){e.next=9;break}return e.next=6,f.a.put(this.loggedUser.sub+"/api/lxd/certificates/"+this.editingItem.fingerprint,{name:this.editingItem.name,type:this.editingItem.type});case 6:t=e.sent,e.next=12;break;case 9:return e.next=11,f.a.post(this.loggedUser.sub+"/api/lxd/certificates",{name:this.editingItem.name,type:this.editingItem.type,certificate:this.editingItem.certificate});case 11:t=e.sent;case 12:422===t.data.code?this.error.editing=t.data.error:(this.error.editing=!1,this.editingIndex>-1?s()(this.items[this.editingIndex],this.editingItem):this.items.push(s()({},this.editingItem)),this.snackbar=!0,this.snackbarText="Certificates successfully saved."),e.next=18;break;case 15:e.prev=15,e.t0=e.catch(1),this.error.global="Could not save certificates to server.";case 18:this.error.editing||-1!==this.editingIndex||this.close(),this.error.editing||this.initialize();case 20:case"end":return e.stop()}},e,this,[[1,15]])}));return function(){return e.apply(this,arguments)}}(),deleteItem:function(){var e=o()(a.a.mark(function e(t){var r=this;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.$prompt.show({persistent:!0,width:400,toolbar:{color:"red darken-3",closable:!1},title:"Delete certificate?",text:"Are you sure you want to delete the <b>"+t.name+"</b> certificate?",buttons:[{title:"Yes",color:"success",handler:function(){var e=o()(a.a.mark(function e(){var i;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return i=r.items.indexOf(t),r.items.splice(i,1),e.prev=2,e.next=5,f.a.delete(r.loggedUser.sub+"/api/lxd/certificates/"+t.fingerprint);case 5:e.sent,r.snackbar=!0,r.snackbarColor="green",r.snackbarText="Certificate deleted.",e.next=14;break;case 11:e.prev=11,e.t0=e.catch(2),r.error.global="Failed to delete certificate.";case 14:case"end":return e.stop()}},e,r,[[2,11]])}));return function(){return e.apply(this,arguments)}}()},{title:"No",color:"error"}]});case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),close:function(){var e=this;this.dialog.editing=!1,this.dialog.generate=!1,setTimeout(function(){e.editingItem=s()({},e.defaultItem),e.editingIndex=-1,e.error.editing=!1,e.cert.pem="",e.cert.key="",e.error={editing:!1,generate:!1}},300)},ucfirst:function(e){return String(e).charAt(0).toUpperCase()+String(e).slice(1)}}}}});