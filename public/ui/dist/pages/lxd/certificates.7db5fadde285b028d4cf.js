webpackJsonp([9],{"9tg/":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=i("rdYn"),a=i("jog2"),n=!1;var s=function(t){n||i("b9L+")},c=i("VU/8")(r.a,a.a,!1,s,null,null);c.options.__file="pages/lxd/certificates.vue",e.default=c.exports},CEiN:function(t,e,i){(t.exports=i("FZ+f")(!1)).push([t.i,"",""])},"b9L+":function(t,e,i){var r=i("CEiN");"string"==typeof r&&(r=[[t.i,r,""]]),r.locals&&(t.exports=r.locals);i("rjj0")("a5c14210",r,!1,{sourceMap:!1})},jog2:function(t,e,i){"use strict";var r=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("v-app",[i("v-snackbar",{attrs:{top:"",timeout:t.snackbarTimeout,color:t.snackbarColor},model:{value:t.snackbar,callback:function(e){t.snackbar=e},expression:"snackbar"}},[t._v("\n    "+t._s(t.snackbarText)+"\n    "),i("v-btn",{attrs:{dark:"",flat:""},nativeOn:{click:function(e){t.snackbar=!1}}},[t._v("Close")])],1),i("v-content",[i("v-container",{attrs:{fluid:"",tag:"section",id:"grid"}},[i("v-layout",{attrs:{row:"",wrap:""}},[i("v-flex",{attrs:{"d-flex":"",xs12:"","order-xs5":""}},[i("v-layout",{attrs:{column:""}},[i("v-flex",{staticClass:"display mb-2",attrs:{tag:"h1"}},[t._v("\n              LXD - Certificates\n              \n              "),i("v-btn",{staticStyle:{float:"right"},attrs:{color:"success"},on:{click:function(e){t.dialog.editing=!0}}},[t._v("Add Certificate")]),i("v-btn",{staticStyle:{float:"right"},on:{click:function(e){t.dialog.generate=!0}}},[t._v("Generate Certificate")])],1),i("v-flex",[i("v-alert",{attrs:{type:"error",value:t.error.global}},[t._v("\n                "+t._s(t.error.global)+"\n              ")]),i("v-data-table",{staticClass:"elevation-1",attrs:{headers:t.tableHeaders,items:t.items,"hide-actions":"",loading:t.tableLoading},scopedSlots:t._u([{key:"items",fn:function(e){return[i("tr",[i("td",[i("a",{attrs:{href:"javascript:void(0)"},on:{click:function(i){i.stopPropagation(),t.editItem(e.item)}}},[t._v(t._s(e.item.name?e.item.name:"-"))])]),i("td",[t._v(t._s(e.item.type?e.item.type:"-"))]),i("td",[t._v(t._s(e.item.fingerprint?e.item.fingerprint:"-"))]),i("td",[i("v-btn",{staticClass:"mx-0",staticStyle:{float:"right"},attrs:{icon:""},on:{click:function(i){i.stopPropagation(),t.deleteItem(e.item)}}},[i("v-icon",{attrs:{color:"pink"}},[t._v("delete")])],1)],1)])]}}])},[i("v-progress-linear",{attrs:{slot:"progress",color:"blue",indeterminate:""},slot:"progress"}),i("template",{slot:"no-data"},[t._v("\n                  "+t._s(t.tableLoading?"Fetching data, please wait...":"There are currently no certificates.")+"\n                ")])],2)],1)],1)],1)],1)],1),i("v-dialog",{attrs:{"max-width":"510px",scrollable:""},model:{value:t.dialog.editing,callback:function(e){t.$set(t.dialog,"editing",e)},expression:"dialog.editing"}},[i("v-card",{attrs:{tile:""}},[i("v-toolbar",{attrs:{card:"",dark:"",color:"light-blue darken-3"}},[i("v-btn",{attrs:{icon:"",dark:""},nativeOn:{click:function(e){t.dialog.editing=!1}}},[i("v-icon",[t._v("close")])],1),i("v-toolbar-title",[t._v(t._s(-1===t.editingIndex?"Add":"Edit")+" Certificate")]),i("v-spacer"),i("v-toolbar-items",[i("v-btn",{attrs:{dark:"",flat:""},nativeOn:{click:function(e){t.save()}}},[t._v("Save")])],1)],1),i("v-card-text",{staticStyle:{padding:"0px"}},[i("v-card",{attrs:{flat:""}},[i("v-card-text",[i("v-alert",{attrs:{type:"error",value:t.error.editing}},[t._v("\n                "+t._s(t.error.editing)+"\n              ")]),i("v-form",{ref:"form",attrs:{"lazy-validation":""},model:{value:t.valid,callback:function(e){t.valid=e},expression:"valid"}},[i("v-text-field",{attrs:{label:"Name:",placeholder:"",required:"",hint:"An optional name for the certificate. If nothing is provided, the host in the TLS header for the request is used."},model:{value:t.editingItem.name,callback:function(e){t.$set(t.editingItem,"name",e)},expression:"editingItem.name"}}),i("v-select",{attrs:{items:["client"],label:"Type:",hint:"Certificate type (keyring), currently only client"},model:{value:t.editingItem.type,callback:function(e){t.$set(t.editingItem,"type",e)},expression:"editingItem.type"}}),-1===t.editingIndex?i("div",[i("v-text-field",{attrs:{label:"PEM Certificate:",placeholder:"",hint:"If provided, a valid x509 certificate. If not, the client certificate of the connection will be used.","multi-line":""},model:{value:t.editingItem.certificate,callback:function(e){t.$set(t.editingItem,"certificate",e)},expression:"editingItem.certificate"}})],1):i("div",[i("h3",[t._v("Client Certificate")]),i("pre",{staticStyle:{"font-size":"12px"}},[t._v(t._s(t.editingItem.certificate))])])],1)],1)],1)],1),i("div",{staticStyle:{flex:"1 1 auto"}})],1)],1),i("v-dialog",{attrs:{"max-width":"510px",scrollable:""},model:{value:t.dialog.generate,callback:function(e){t.$set(t.dialog,"generate",e)},expression:"dialog.generate"}},[i("v-card",{attrs:{tile:""}},[i("v-toolbar",{attrs:{card:"",dark:"",color:"light-blue darken-3"}},[i("v-btn",{attrs:{icon:"",dark:""},nativeOn:{click:function(e){t.dialog=!1}}},[i("v-icon",[t._v("close")])],1),i("v-toolbar-title",[t._v("Generate Certificate")]),i("v-spacer"),i("v-toolbar-items",[i("v-btn",{attrs:{dark:"",flat:""},nativeOn:{click:function(e){t.generateCert()}}},[t._v("Generate")])],1)],1),i("v-card-text",{staticStyle:{padding:"0px"}},[i("v-card",{attrs:{flat:""}},[i("v-card-text",[i("v-alert",{attrs:{type:"error",value:t.error.generate}},[t._v("\n                "+t._s(t.error.generate)+"\n              ")]),i("v-form",{ref:"form",attrs:{"lazy-validation":""},model:{value:t.valid,callback:function(e){t.valid=e},expression:"valid"}},[""!==t.cert.key?i("div",[i("h2",[t._v("Client Certificate "),i("v-btn",{staticStyle:{float:"right"},attrs:{dark:"",small:"",color:"success"},on:{click:function(e){t.addCert()}}},[t._v("Add")]),i("v-btn",{staticStyle:{float:"right"},attrs:{dark:"",small:"",color:"blue"},on:{click:function(e){t.downloadCert("pem")}}},[t._v("Download")])],1),i("pre",{staticStyle:{"font-size":"12px"}},[t._v(t._s(t.cert.pem))]),i("h2",{staticStyle:{"margin-top":"15px"}},[t._v("Private Key "),i("v-btn",{staticStyle:{float:"right"},attrs:{dark:"",small:"",color:"blue"},on:{click:function(e){t.downloadCert("key")}}},[t._v("Download")])],1),i("pre",{staticStyle:{"font-size":"12px"}},[t._v(t._s(t.cert.key))])]):i("div",[i("h3",[t._v("General")]),i("v-select",{attrs:{items:[2048,4096,8192],label:"Key Length:",hint:"RSA key length."},model:{value:t.cert.bits,callback:function(e){t.$set(t.cert,"bits",e)},expression:"cert.bits"}}),i("v-text-field",{attrs:{label:"Days:",placeholder:"",required:"",hint:"Length in days the certificate is valid for."},model:{value:t.cert.days,callback:function(e){t.$set(t.cert,"days",e)},expression:"cert.days"}}),i("h3",[t._v("CSR Subject")]),i("v-text-field",{attrs:{label:"Common Name:",placeholder:"",required:"",hint:"Primary domain of the certificate. For Wildcard certificates, the domain name should be represented with an asterisk in front (e.g. *.example.com)."},model:{value:t.cert.subject.cn,callback:function(e){t.$set(t.cert.subject,"cn",e)},expression:"cert.subject.cn"}}),i("v-text-field",{attrs:{label:"Country:",placeholder:"",required:"",hint:"Two-letter country code. e.g. GB"},model:{value:t.cert.subject.c,callback:function(e){t.$set(t.cert.subject,"c",e)},expression:"cert.subject.c"}}),i("v-text-field",{attrs:{label:"State:",placeholder:"",required:"",hint:"State, county or region. e.g: London"},model:{value:t.cert.subject.st,callback:function(e){t.$set(t.cert.subject,"st",e)},expression:"cert.subject.st"}}),i("v-text-field",{attrs:{label:"Locality:",placeholder:"",required:"",hint:"City or town. e.g: Wimbledon"},model:{value:t.cert.subject.l,callback:function(e){t.$set(t.cert.subject,"l",e)},expression:"cert.subject.l"}}),i("v-text-field",{attrs:{label:"Organization:",placeholder:"",required:"",hint:"Registered name of the organization. e.g: Conext"},model:{value:t.cert.subject.o,callback:function(e){t.$set(t.cert.subject,"o",e)},expression:"cert.subject.o"}}),i("v-text-field",{attrs:{label:"Organization Unit:",placeholder:"",required:"",hint:"Name of the department. e.g: IT Department"},model:{value:t.cert.subject.ou,callback:function(e){t.$set(t.cert.subject,"ou",e)},expression:"cert.subject.ou"}})],1)])],1)],1)],1),i("div",{staticStyle:{flex:"1 1 auto"}})],1)],1)],1)],1)};r._withStripped=!0;var a={render:r,staticRenderFns:[]};e.a=a},rO6o:function(t,e,i){"use strict";e.a={methods:{formatBytes:function(t,e){if(0===t)return"0 Bytes";var i=e||2,r=Math.floor(Math.log(t)/Math.log(1024));return parseFloat((t/Math.pow(1024,r)).toFixed(i))+" "+["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"][r]},isIP4:function(t){return!!/^([0-9]{1,3}\.){3}[0-9]{1,3}(\/([0-9]|[1-2][0-9]|3[0-2]))?$/.test(t)},uniqueId:function(t){t||(t=8);for(var e="",i=1;i<t+1;i+=8)e+=Math.random().toString(36).substr(2,10);return e.substr(0,t)},UUID:function(){function t(){return Math.random().toString(16).slice(-4)}return t()+t()+"-"+t()+"-"+t()+"-"+t()+"-"+t()+t()+t()}}}},rdYn:function(t,e,i){"use strict";var r=i("Xxa5"),a=i.n(r),n=i("exGp"),s=i.n(n),c=i("woOf"),o=i.n(c),l=i("Dd8w"),d=i.n(l),u=i("NYxO"),f=(i("4swq"),i("mtWM")),v=i.n(f),h=i("rO6o");e.a={mixins:[h.a],middleware:["authenticated"],components:{},computed:d()({},Object(u.mapGetters)({isAuthenticated:"auth/isAuthenticated",loggedUser:"auth/loggedUser",loggedToken:"auth/loggedToken"})),data:function(){return{dialog:{editing:!1,generate:!1},valid:!0,error:{global:!1,editing:!1,generate:!1},snackbar:!1,snackbarColor:"green",snackbarText:"",snackbarTimeout:5e3,items:[],cert:{bits:2048,days:365,subject:{c:"",st:"",l:"",o:"",ou:"",cn:""},key:"",pem:""},tableLoading:!0,tableHeaders:[{text:"Name",value:"name"},{text:"Type",value:"type"},{text:"Fingerprint",value:"fingerprint"},{text:"Actions",value:"action",sortable:!1,align:"right"}],editingIndex:-1,editingItem:{name:"",type:"client",fingerprint:"",certificate:""},defaultItem:{name:"",type:"client",fingerprint:"",certificate:""},nameRule:[function(t){return!!t||"Name is required"},function(t){return t&&t.length<=15||"Name is too long (maximum 15 characters)"}]}},beforeDestroy:function(){},mounted:function(){var t=this;v.a.defaults.headers.common.Authorization="Bearer "+this.loggedToken,this.$nextTick(function(){t.initialize(),t.cert=o()(t.cert,t.$storage.get("cert_default"))})},watch:{"dialog.editing":function(t){t||this.close()},"dialog.generate":function(t){t||this.close()}},methods:{initialize:function(){var t=s()(a.a.mark(function t(){var e;return a.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,this.loggedUser||this.$router.replace("/servers"),t.next=4,v.a.get(this.loggedUser.sub+"/api/lxd/certificates");case 4:e=t.sent,this.items=e.data.data,t.next=13;break;case 8:t.prev=8,t.t0=t.catch(0),this.items=[],this.tableNoData="No data.",this.error.global="Could not fetch data from server.";case 13:this.tableLoading=!1;case 14:case"end":return t.stop()}},t,this,[[0,8]])}));return function(){return t.apply(this,arguments)}}(),generateCert:function(){var t=s()(a.a.mark(function t(){var e;return a.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,this.loggedUser||this.$router.replace("/servers"),this.$storage.set("cert_default",{bits:this.cert.bits,days:this.cert.days,subject:{c:this.cert.subject.c,st:this.cert.subject.st,l:this.cert.subject.l,o:this.cert.subject.o,ou:this.cert.subject.ou,cn:this.cert.subject.cn}}),t.next=5,v.a.post(this.loggedUser.sub+"/api/lxd/certificates/generate",this.cert);case 5:e=t.sent,this.cert=e.data.data,t.next=11;break;case 9:t.prev=9,t.t0=t.catch(0);case 11:case"end":return t.stop()}},t,this,[[0,9]])}));return function(){return t.apply(this,arguments)}}(),downloadCert:function(t){var e=document.createElement("a");e.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(this.cert[t])),e.setAttribute("download","cert."+("pem"==t?"pem":"key")),e.style.display="none",document.body.appendChild(e),e.click(),document.body.removeChild(e)},addCert:function(){var t=s()(a.a.mark(function t(){var e;return a.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,this.loggedUser||this.$router.replace("/servers"),t.next=4,v.a.post(this.loggedUser.sub+"/api/lxd/certificates",{name:this.cert.subject.cn,type:"client",certificate:this.cert.pem});case 4:200==(e=t.sent).data.code&&(this.snackbar=!0,this.snackbarText="Certificate successfully added.",this.initialize()),e.data.error&&(this.error.generate=e.data.error),t.next=12;break;case 9:t.prev=9,t.t0=t.catch(0),this.error.global="Could not save certificates to server.";case 12:case"end":return t.stop()}},t,this,[[0,9]])}));return function(){return t.apply(this,arguments)}}(),editItem:function(t){this.editingIndex=this.items.indexOf(t),this.editingItem=o()({},this.defaultItem,t),this.dialog.editing=!0},save:function(){var t=s()(a.a.mark(function t(){var e;return a.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.$refs.form.validate()){t.next=20;break}if(t.prev=1,this.loggedUser||this.$router.replace("/servers"),!(this.editingIndex>-1)){t.next=9;break}return t.next=6,v.a.put(this.loggedUser.sub+"/api/lxd/certificates/"+this.editingItem.fingerprint,{name:this.editingItem.name,type:this.editingItem.type});case 6:e=t.sent,t.next=12;break;case 9:return t.next=11,v.a.post(this.loggedUser.sub+"/api/lxd/certificates",{name:this.editingItem.name,type:this.editingItem.type,certificate:this.editingItem.certificate});case 11:e=t.sent;case 12:422===e.data.code?this.error.editing=e.data.error:(this.error.editing=!1,this.editingIndex>-1?o()(this.items[this.editingIndex],this.editingItem):this.items.push(o()({},this.editingItem)),this.snackbar=!0,this.snackbarText="Certificates successfully saved."),t.next=18;break;case 15:t.prev=15,t.t0=t.catch(1),this.error.global="Could not save certificates to server.";case 18:this.error.editing||-1!==this.editingIndex||this.close(),this.error.editing||this.initialize();case 20:case"end":return t.stop()}},t,this,[[1,15]])}));return function(){return t.apply(this,arguments)}}(),deleteItem:function(){var t=s()(a.a.mark(function t(e){var i=this;return a.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:this.$prompt.show({persistent:!0,width:400,toolbar:{color:"red darken-3",closable:!1},title:"Delete certificate?",text:"Are you sure you want to delete the <b>"+e.name+"</b> certificate?",buttons:[{title:"Yes",color:"success",handler:function(){var t=s()(a.a.mark(function t(){var r;return a.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r=i.items.indexOf(e),i.items.splice(r,1),t.prev=2,t.next=5,v.a.delete(i.loggedUser.sub+"/api/lxd/certificates/"+e.fingerprint);case 5:t.sent,i.snackbar=!0,i.snackbarColor="green",i.snackbarText="Certificate deleted.",t.next=14;break;case 11:t.prev=11,t.t0=t.catch(2),i.error.global="Failed to delete certificate.";case 14:case"end":return t.stop()}},t,i,[[2,11]])}));return function(){return t.apply(this,arguments)}}()},{title:"No",color:"error"}]});case 1:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}(),close:function(){var t=this;this.dialog.editing=!1,this.dialog.generate=!1,setTimeout(function(){t.editingItem=o()({},t.defaultItem),t.editingIndex=-1,t.error.editing=!1,t.cert.pem="",t.cert.key="",t.error={editing:!1,generate:!1}},300)},ucfirst:function(t){return String(t).charAt(0).toUpperCase()+String(t).slice(1)}}}}});